<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>pycheron.metrics.crossCorrMetric &#8212; Pycheron 2.1.0 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html"><span><img src="_static/horse-128.png"></span>
          Pycheron</a>
        <span class="navbar-text navbar-version pull-left"><b>2.1</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="install.html">Install</a></li>
                <li><a href="pycheron.html">Documentation</a></li>
                <li><a href="https://gitlab.sandia.gov/lynm/pycheron">Gitlab</a></li>
                <li><a href="tutorials">Tutorials</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Documentation <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">pycheron.metrics.crossCorrMetric</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="section" id="module-pycheron.metrics.crossCorrMetric">
<span id="pycheron-metrics-crosscorrmetric"></span><h1>pycheron.metrics.crossCorrMetric<a class="headerlink" href="#module-pycheron.metrics.crossCorrMetric" title="Permalink to this headline">¶</a></h1>
<dl class="function">
<dt id="pycheron.metrics.crossCorrMetric.crossCorrMetric">
<code class="descname">crossCorrMetric</code><span class="sig-paren">(</span><em>tr1</em>, <em>tr2</em>, <em>maxLagSecs=10</em>, <em>filt='lowpass'</em>, <em>freqmin=1.0</em>, <em>freqmax=100.0</em>, <em>corners=4</em>, <em>zerophase=False</em>, <em>maxorder=None</em>, <em>ba=False</em>, <em>freq_passband=False</em>, <em>logger=None</em>, <em>database=None</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pycheron/metrics/crossCorrMetric.html#crossCorrMetric"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pycheron.metrics.crossCorrMetric.crossCorrMetric" title="Permalink to this definition">¶</a></dt>
<dd><p>Cross-correlates the current data with the neighboring data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>tr1</strong> (<cite>obspy.core.trace.Trace</cite>) – obspy trace object 1</li>
<li><strong>tr2</strong> (<cite>obspy.core.trace.Trace</cite>) – obspy trace object 2</li>
<li><strong>maxLagSecs</strong> (<em>int</em>) – Maximum number of seconds of lag to use</li>
<li><strong>filt</strong> (<em>str</em>) – Choose from the following filter options: <cite>“bandpass”</cite>, <cite>“bandstop”</cite>, <cite>“envelope”</cite>, <cite>“highpass”</cite>, <cite>“integer_decimation”</cite>, <cite>“lowpass”</cite>, <cite>“lowpass_cheby_2”</cite>. See <a class="reference internal" href="#filter-options">Filter_Options</a> .</li>
<li><strong>freqmin</strong> (<em>int</em>) – Depending on the filter utilized, either pass band low corner frequency (bandpass, bandstop), filter corner frequency (lowpass), or the frequency above which signals are attenuated with 95 dB</li>
<li><strong>freqmax</strong> (<em>int</em>) – Depending on the filter utilized, either passband high corner frequency (bandpass, bandstop), or filter corner frequency (highpass)</li>
<li><strong>corners</strong> (<em>int</em>) – Filter corners/order</li>
<li><strong>zerophase</strong> (<em>bool</em>) – If True, applies filter once forward and once backwards. This results in twice the filter order but zero phase shift in the resulting filtered trace.</li>
<li><strong>decimation_factor</strong> (<em>int</em>) – Integer decimation factor</li>
<li><strong>maxorder</strong> (<em>int</em>) – Maximal order of designed cheby2 filter (option for lowpass_cheby2 only)</li>
<li><strong>ba</strong> (<em>bool</em>) – If True, returns only the filter coefficients (b,a) instead of filtering. (option for lowpass_cheby2 only)</li>
<li><strong>freq_passband</strong> (<em>bool</em>) – If True, return additionally to the filtered data, then iteratively determine the pass band frequency. (option for lowpass_cheby2 only)</li>
<li><strong>logger</strong> (<a class="reference internal" href="pycheron.util.logger.html#pycheron.util.logger.Logger" title="pycheron.util.logger.Logger"><em>pycheron.util.logger.Logger</em></a>) – If using a logger, (you must create one using the util.logger class)</li>
<li><strong>database</strong> (<a class="reference internal" href="pycheron.db.sqllite_db.html#pycheron.db.sqllite_db.Database" title="pycheron.db.sqllite_db.Database"><em>pycheron.db.sqllite_db.Database</em></a>) – database object</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><p>Dictionary containing the following keys and types:</p>
<ul class="simple">
<li>snclq (<cite>str</cite>)</li>
<li>snclq1_starttime (<cite>str</cite>)</li>
<li>snclq1_endtime (<cite>str</cite>)</li>
<li>snclq2_starttime (<cite>str</cite>)</li>
<li>snclq2_endtime (<cite>str</cite>)</li>
<li>peak_correlation (<cite>float</cite>)</li>
<li>peak_lag (<cite>float</cite>)</li>
<li>metric_name (<cite>str</cite>)</li>
</ul>
</p>
</td>
</tr>
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">dict</p>
</td>
</tr>
</tbody>
</table>
<p>Finds the min and max of the cross-correlation function of these, saves the value with the largest absolute value (preserve the sign). Preserves the lag in seconds to the min or max value saved above.
Finds the difference in traveltime between the 2 traces: (current - neighbor). Adjusts the lag by subtracting this difference (preserving sign) from the lag. In short, calculates the maximum absolute correlation (polarity_check
(peak correlation)) and lg at maximum correlation (timing_drift, peak lag) associated with two traces.</p>
<p id="filter-options"><strong>Filter Options</strong></p>
<ul class="simple">
<li><dl class="first docutils">
<dt>“bandpass” - Butterworth-Bandpass Filter</dt>
<dd><em>Parameters Required</em><ul class="last">
<li><strong>freqmin</strong> (<cite>int</cite>) - Pass band low corner frequency</li>
<li><strong>freqmax</strong> (<cite>int</cite>) - Pass band high corner frequency</li>
<li><strong>df</strong> (<cite>int</cite>) - sampling rate in Hz (get from tr.stats.sampling_rate so not needed as input param)</li>
<li><strong>corners</strong> (<cite>int</cite>) - Filter corners/order.</li>
<li><strong>zerophase</strong> (<cite>bool</cite>) - If True, applies filter once forward and once backwards. This results in twice the filter order but zero phase shift in the resulting filtered trace.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>“bandstop” - Butterworth-Bandstop Filter</dt>
<dd><em>Parameters Required</em><ul class="last">
<li><strong>freqmin</strong> (<cite>int</cite>) - Pass band low corner frequency</li>
<li><strong>freqmax</strong> (<cite>int</cite>) - Pass band high corner frequency</li>
<li><strong>df</strong> (<cite>int</cite>) - sampling rate in Hz (get from tr.stats.sampling_rate so not needed as input param)</li>
<li><strong>corners</strong> (<cite>int</cite>) - Filter corners/order.</li>
<li><strong>zerophase</strong> (<cite>bool</cite>) - If True, applies filter once forward and once backwards. This results in twice the filter order but zero phase shift in the resulting filtered trace.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>“envelope” - Envelope function</dt>
<dd><em>Parameters Required</em><ul class="last">
<li><strong>None</strong></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>“highpass” - Butterworth-Highpass Filter</dt>
<dd><em>Parameters Required</em><ul class="last">
<li><strong>freqmax</strong> (<cite>int</cite>) - Pass band high corner frequency</li>
<li><strong>df</strong> (<cite>int</cite>) - sampling rate in Hz (get from tr.stats.sampling_rate so not needed as input param)</li>
<li><strong>corners</strong> (<cite>int</cite>) - Filter corners/order.</li>
<li><strong>zerophase</strong> (<cite>bool</cite>) - If True, applies filter once forward and once backwards. This results in twice the filter order but zero phase shift in the resulting filtered trace.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>“integer_decimation” - Downsampling by applying a simple integer decimation</dt>
<dd><em>Parameters Required</em><ul class="last">
<li><strong>decimation_factor</strong> (<cite>int</cite>) - Integer decimation factor</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>“lowpass” - Butterwoth-Lowpass Filter</dt>
<dd><em>Parameters Required</em><ul class="last">
<li><strong>freqmin</strong> (<cite>int</cite>) - Pass band low corner frequency</li>
<li><strong>df</strong> (<cite>int</cite>) - sampling rate in Hz (get from tr.stats.sampling_rate so not needed as input param)</li>
<li><strong>corners</strong> (<cite>int</cite>) - Filter corners/order.</li>
<li><strong>zerophase</strong> (<cite>bool</cite>) - If True, applies filter once forward and once backwards. This results in twice the filter order but zero phase shift in the resulting filtered trace.</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>“lowpass_cheby_2” - Cheby2- Lowpass Filter</dt>
<dd><em>Parameters Required</em><ul class="last">
<li><strong>freqmin</strong> (<cite>int</cite>) - Pass band low corner frequency</li>
<li><strong>maxorder</strong> (<cite>int</cite>) - Maximal order of designed cheby2 filter</li>
<li><strong>ba</strong> (‘bool’) - If True, returns only the filter coefficients (b,a) instead of filtering. (DEFAULT = False)</li>
<li><strong>freq_passband</strong> (<cite>bool</cite>) - If True, return additionally to the filtered data, then iteratively determine the pass band frequency.</li>
</ul>
</dd>
</dl>
</li>
</ul>
<p><strong>Examples</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize IRIS client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="s2">&quot;IRIS&quot;</span><span class="p">)</span>

<span class="c1"># Define start/end time and then get same signal shifted by 3 seconds</span>
<span class="n">starttime</span> <span class="o">=</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="s2">&quot;2013-11-12T07:09:45.000&quot;</span><span class="p">)</span>
<span class="n">endtime</span> <span class="o">=</span> <span class="n">starttime</span> <span class="o">+</span> <span class="mi">600</span>
<span class="n">st1</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="s2">&quot;NM&quot;</span><span class="p">,</span><span class="s2">&quot;SLM&quot;</span><span class="p">,</span><span class="s2">&quot;00&quot;</span><span class="p">,</span><span class="s2">&quot;BHZ&quot;</span><span class="p">,</span><span class="n">starttime</span><span class="p">,</span> <span class="n">endtime</span><span class="p">)</span>
<span class="n">st2</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_waveforms</span><span class="p">(</span><span class="s2">&quot;NM&quot;</span><span class="p">,</span><span class="s2">&quot;SLM&quot;</span><span class="p">,</span><span class="s2">&quot;00&quot;</span><span class="p">,</span><span class="s2">&quot;BHZ&quot;</span><span class="p">,</span><span class="n">starttime</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span> <span class="n">endtime</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>

<span class="c1">#Get trace data for each stream</span>
<span class="n">tr1</span> <span class="o">=</span> <span class="n">st1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">tr2</span> <span class="o">=</span> <span class="n">st2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1">#Cross-correlate</span>
<span class="n">CC</span> <span class="o">=</span> <span class="n">crossCorrMetric</span><span class="p">(</span><span class="n">tr1</span><span class="p">,</span><span class="n">tr2</span><span class="p">,</span><span class="n">freqmin</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">corners</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">print</span><span class="p">(</span><span class="n">CC</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">{</span><span class="s1">&#39;peak_correlation&#39;</span><span class="p">:</span> <span class="mf">0.3450079442293356</span><span class="p">,</span> <span class="s1">&#39;snclq1_starttime&#39;</span><span class="p">:</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">45</span><span class="p">),</span> <span class="s1">&#39;snclq2_endtime&#39;</span><span class="p">:</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">48</span><span class="p">),</span> <span class="s1">&#39;snclq2&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;NM.SLM.00.BHZ.M&#39;</span><span class="p">,</span> <span class="s1">&#39;snclq1&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;NM.SLM.00.BHZ.M&#39;</span><span class="p">,</span> <span class="s1">&#39;peak_lag (s)&#39;</span><span class="p">:</span> <span class="mf">0.008580576472234229</span><span class="p">,</span> <span class="s1">&#39;snclq2_starttime&#39;</span><span class="p">:</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">48</span><span class="p">),</span> <span class="s1">&#39;metric_name&#39;</span><span class="p">:</span> <span class="s1">&#39;crossCorrMetric&#39;</span><span class="p">,</span> <span class="s1">&#39;snclq1_endtime&#39;</span><span class="p">:</span> <span class="n">UTCDateTime</span><span class="p">(</span><span class="mi">2013</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">45</span><span class="p">)}</span>
</pre></div>
</div>
</dd></dl>

</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2019, Jessica Bobeck, Katherine Anderson Aur.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.<br/>
    </p>
  </div>
</footer>
  </body>
</html>